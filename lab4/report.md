# Отчет о лабораторной работе: Метод Монте-Карло

## Цель работы

Целью данной лабораторной работы является решение вероятностных задач из задачника (Коршунов, Фосс) методом Монте-Карло, сравнение полученных приближенных результатов с точными аналитическими решениями и анализ точности метода.

## Задачи

В работе решены три задачи:

1. **Задача 2.7** (глава 2 - Классическое вероятностное пространство): Бросаются 4 игральные кости. Найти вероятность того, что на них выпадет по одинаковому числу очков.

2. **Задача 2.8** (глава 2 - Классическое вероятностное пространство): В ящике 10 красных и 6 синих пуговиц. Какова вероятность того, что две наудачу вынутые пуговицы будут одноцветными?

3. **Задача 3.8** (глава 3 - Геометрические вероятности): Стержень длины l разломан в двух наудачу выбранных точках. С какой вероятностью из полученных отрезков можно составить треугольник?

---

## Методология

### Метод Монте-Карло

Метод Монте-Карло — это численный метод решения вероятностных задач путем многократного моделирования случайных экспериментов. Основная идея метода:

1. **Моделирование случайных событий**: Генерируем большое количество случайных исходов эксперимента
2. **Подсчет благоприятных исходов**: Считаем, сколько раз произошло интересующее нас событие
3. **Оценка вероятности**: Вероятность ≈ (число благоприятных исходов) / (общее число экспериментов)

Точность метода увеличивается с ростом числа экспериментов.

### Используемые библиотеки

- `numpy` — для работы с массивами и генерации случайных чисел
- `random` — для генерации случайных чисел
- `scipy.special` — для вычисления комбинаторных формул
- `matplotlib` — для визуализации результатов
- `pandas` — для создания итоговых таблиц

---

## Подробное описание решения задач

### Задача 2.7: Бросание 4 игральных костей

#### Постановка задачи
Бросаются 4 игральные кости. Нужно найти вероятность того, что на всех четырех костях выпадет одинаковое число очков.

#### Реализация метода Монте-Карло

**Шаг 1: Инициализация**
- Устанавливаем зерно генератора случайных чисел (`random.seed(42)`) для воспроизводимости результатов
- Задаем количество экспериментов: `n_exp = 100000`
- Определяем пространство элементарных событий: значения на кости от 1 до 6

**Шаг 2: Моделирование экспериментов**
```python
for i in range(n_exp):
    # Бросаем 4 кости (выборка с возвращением)
    dice = random.choices(A, k=4)
    
    # Проверяем, все ли кости показывают одинаковое число
    if dice[0] == dice[1] == dice[2] == dice[3]:
        k_success += 1
```

**Шаг 3: Вычисление вероятности**
```python
prob_mc = k_success / n_exp
```

**Результат метода Монте-Карло**: 0.004560 (после 100,000 экспериментов)

#### Точное аналитическое решение

Для классической вероятности используем формулу:
$$P = \frac{\text{число благоприятных исходов}}{\text{общее число исходов}}$$

- **Общее число исходов**: При бросании 4 костей каждый может показать от 1 до 6, поэтому всего $6^4 = 1296$ исходов
- **Благоприятные исходы**: Все 4 кости показывают одинаковое число. Это может быть:
  - (1,1,1,1)
  - (2,2,2,2)
  - (3,3,3,3)
  - (4,4,4,4)
  - (5,5,5,5)
  - (6,6,6,6)
  
  Всего 6 благоприятных исходов.

**Точная вероятность**: 
$$P = \frac{6}{6^4} = \frac{6}{1296} = \frac{1}{216} \approx 0.00462963$$

#### Сравнение результатов

| Метод | Значение | Абсолютная ошибка | Относительная ошибка |
|-------|----------|-------------------|---------------------|
| Монте-Карло | 0.004560 | 0.000070 | 1.504% |
| Точное значение | 0.004630 | - | - |

**Вывод**: Метод Монте-Карло дал хорошее приближение с относительной ошибкой менее 2%.

#### Визуализация сходимости

Для визуализации сходимости метода был построен график зависимости приближенной вероятности от числа проведенных экспериментов. График показывает, как оценка вероятности стабилизируется вокруг точного значения по мере увеличения числа экспериментов.

---

### Задача 2.8: Пуговицы в ящике

#### Постановка задачи
В ящике находится 10 красных и 6 синих пуговиц (всего 16). Наудачу вынимаются 2 пуговицы. Нужно найти вероятность того, что обе пуговицы будут одного цвета (либо обе красные, либо обе синие).

#### Реализация метода Монте-Карло

**Шаг 1: Инициализация**
- Устанавливаем зерно генератора: `random.seed(12345)`
- Количество экспериментов: `n_exp = 100000`
- Создаем модель ящика: список из 10 красных ('R') и 6 синих ('B') пуговиц

**Шаг 2: Моделирование экспериментов**
```python
for i in range(n_exp):
    # Выбираем 2 пуговицы без возвращения
    selected = random.sample(buttons, 2)
    
    # Проверяем, одного ли они цвета
    if selected[0] == selected[1]:
        k_success += 1
```

**Важно**: Используется `random.sample()` для выборки без возвращения, так как пуговицы вынимаются из ящика и не возвращаются обратно.

**Результат метода Монте-Карло**: 0.500980 (после 100,000 экспериментов)

#### Точное аналитическое решение

Используем комбинаторный подход:

- **Общее число способов выбрать 2 пуговицы из 16**: 
  $$C(16,2) = \frac{16!}{2!(16-2)!} = \frac{16 \cdot 15}{2} = 120$$

- **Благоприятные исходы**:
  - Выбрать 2 красные из 10: $C(10,2) = \frac{10 \cdot 9}{2} = 45$
  - Выбрать 2 синие из 6: $C(6,2) = \frac{6 \cdot 5}{2} = 15$
  - Всего: $45 + 15 = 60$

**Точная вероятность**:
$$P = \frac{C(10,2) + C(6,2)}{C(16,2)} = \frac{45 + 15}{120} = \frac{60}{120} = 0.5$$

#### Сравнение результатов

| Метод | Значение | Абсолютная ошибка | Относительная ошибка |
|-------|----------|-------------------|---------------------|
| Монте-Карло | 0.500980 | 0.000980 | 0.196% |
| Точное значение | 0.500000 | - | - |

**Вывод**: Метод Монте-Карло показал отличную точность с относительной ошибкой менее 0.2%.

#### Визуализация сходимости

График сходимости демонстрирует быструю стабилизацию оценки вероятности вокруг точного значения 0.5.

---

### Задача 3.8: Стержень и треугольник

#### Постановка задачи
Стержень длины $l$ разломан в двух наудачу выбранных точках. Нужно найти вероятность того, что из трех полученных отрезков можно составить треугольник.

#### Реализация метода Монте-Карло

**Шаг 1: Инициализация**
- Устанавливаем зерно генератора: `np.random.seed(54321)`
- Количество экспериментов: `n_exp = 100000`
- Без потери общности принимаем длину стержня $l = 1$

**Шаг 2: Моделирование экспериментов**
```python
for i in range(n_exp):
    # Выбираем две случайные точки разлома
    x, y = sorted(np.random.uniform(0, l, 2))
    
    # Вычисляем длины трех отрезков
    a = x                    # первый отрезок
    b = y - x                # второй отрезок
    c = l - y                # третий отрезок
    
    # Проверяем неравенство треугольника
    if (a + b > c) and (a + c > b) and (b + c > a):
        k_success += 1
```

**Важно**: Используем `sorted()` для упорядочивания точек разлома, чтобы гарантировать $0 < x < y < l$.

**Результат метода Монте-Карло**: 0.248360 (после 100,000 экспериментов)

#### Точное аналитическое решение

Для геометрической вероятности используем геометрический подход.

**Условия для треугольника**: Для трех отрезков $a$, $b$, $c$ должны выполняться все три неравенства треугольника:
- $a + b > c$
- $a + c > b$
- $b + c > a$

Если стержень длины $l=1$ разломан в точках $x$ и $y$ ($0 < x < y < 1$), то:
- $a = x$
- $b = y - x$
- $c = 1 - y$

**Преобразуем условия**:

1. $a + b > c$: $x + (y-x) > 1-y$ → $y > 1/2$
2. $a + c > b$: $x + (1-y) > y-x$ → $x < 1/2$
3. $b + c > a$: $(y-x) + (1-y) > x$ → $1 > 2x$ → $x < 1/2$

**Итак, нужно**: $x < 1/2$ и $y > 1/2$, при условии $x < y$.

**Геометрическая интерпретация**:
- Вся область возможных значений $(x, y)$: треугольник в координатах, где $0 < x < y < 1$. Площадь = $1/2$.
- Благоприятная область: $x < 1/2$, $y > 1/2$, $x < y$. Это квадрат $[0, 1/2] \times [1/2, 1]$ с учетом $x < y$. Площадь = $(1/2) \cdot (1/2) = 1/4$.

**Точная вероятность**:
$$P = \frac{\text{площадь благоприятной области}}{\text{площадь всей области}} = \frac{1/4}{1/2} = \frac{1}{4} = 0.25$$

#### Сравнение результатов

| Метод | Значение | Абсолютная ошибка | Относительная ошибка |
|-------|----------|-------------------|---------------------|
| Монте-Карло | 0.248360 | 0.001640 | 0.656% |
| Точное значение | 0.250000 | - | - |

**Вывод**: Метод Монте-Карло дал хорошее приближение с относительной ошибкой менее 1%.

#### Визуализация сходимости

График показывает сходимость оценки вероятности к точному значению 0.25 по мере увеличения числа экспериментов.

---

## Итоговые результаты

### Сводная таблица

| Задача | Метод Монте-Карло | Точное значение | Абсолютная ошибка | Относительная ошибка (%) |
|--------|-------------------|-----------------|-------------------|-------------------------|
| 2.7: 4 кости (одинаковые) | 0.004560 | 0.004630 | 0.000070 | 1.504 |
| 2.8: Пуговицы (одноцветные) | 0.500980 | 0.500000 | 0.000980 | 0.196 |
| 3.8: Стержень (треугольник) | 0.248360 | 0.250000 | 0.001640 | 0.656 |

### Анализ точности

1. **Задача 2.7** (кости): Относительная ошибка 1.504% — хорошая точность для вероятности порядка $10^{-3}$.

2. **Задача 2.8** (пуговицы): Относительная ошибка 0.196% — отличная точность, метод показал высокую эффективность.

3. **Задача 3.8** (стержень): Относительная ошибка 0.656% — хорошая точность для геометрической вероятности.

### Выводы

1. **Эффективность метода Монте-Карло**: При 100,000 экспериментах метод показал высокую точность для всех трех задач с относительными ошибками менее 2%.

2. **Сходимость**: Визуализация сходимости показала, что оценки стабилизируются вокруг точных значений уже после нескольких тысяч экспериментов.

3. **Применимость**: Метод Монте-Карло успешно применяется как для классических вероятностных задач (дискретные случайные величины), так и для геометрических вероятностей (непрерывные случайные величины).

4. **Воспроизводимость**: Использование фиксированных зерен генераторов случайных чисел (`seed`) обеспечивает воспроизводимость результатов.

---

## Технические детали реализации

### Параметры экспериментов

- **Количество экспериментов**: 100,000 для каждой задачи
- **Генераторы случайных чисел**:
  - `random` (Python) для задач 2.7 и 2.8
  - `numpy.random` для задачи 3.8 (геометрическая вероятность)
- **Зерна генераторов**: 
  - Задача 2.7: `seed=42`
  - Задача 2.8: `seed=12345`
  - Задача 3.8: `seed=54321`

### Особенности реализации

1. **Задача 2.7**: Использование `random.choices()` для выборки с возвращением (бросание костей).

2. **Задача 2.8**: Использование `random.sample()` для выборки без возвращения (вынимание пуговиц).

3. **Задача 3.8**: Использование `np.random.uniform()` для генерации непрерывных случайных величин и проверка неравенства треугольника.

### Визуализация

Для каждой задачи построены графики сходимости метода Монте-Карло, показывающие:
- Динамику изменения оценки вероятности
- Сравнение с точным значением (горизонтальная линия)
- Стабилизацию оценки при увеличении числа экспериментов

---

## Заключение

В ходе лабораторной работы были успешно решены три вероятностные задачи методом Монте-Карло:

1. **Классическая вероятность** (задачи 2.7 и 2.8): Метод показал высокую точность при моделировании дискретных случайных событий.

2. **Геометрическая вероятность** (задача 3.8): Метод успешно применим для задач с непрерывными случайными величинами.

Все полученные приближенные значения хорошо согласуются с точными аналитическими решениями, что подтверждает эффективность метода Монте-Карло для решения вероятностных задач различной природы.

---

*Работа выполнена с использованием Python 3, библиотек NumPy, SciPy, Matplotlib и Pandas.*


